{% extends 'base.html' %}
{% load static %}

{% block title %}Mortgage Calculator - RealtyPro{% endblock %}

{% block content %}
<!-- Calculator Header -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold text-primary mb-3">Mortgage Calculator</h1>
                <p class="lead text-muted mb-4">Calculate your monthly mortgage payments and understand the total cost of homeownership</p>
            </div>
        </div>
    </div>
</section>

<!-- Calculator Section -->
<section class="calculator-section">
    <div class="container">
        <div class="row">
            <!-- Calculator Form -->
            <div class="col-lg-6">
                <div class="calculator-card">
                    <h2 class="fw-bold mb-4">Calculate Your Payment</h2>
                    
                    <form id="mortgage-form">
                        <div class="mb-3">
                            <label for="property-price" class="form-label">Property Price ($)</label>
                            <input type="number" class="form-control" id="property-price" placeholder="500,000" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="down-payment" class="form-label">Down Payment ($)</label>
                            <input type="number" class="form-control" id="down-payment" placeholder="100,000" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="loan-term" class="form-label">Loan Term (Years)</label>
                            <select class="form-select" id="loan-term" required>
                                <option value="15">15 Years</option>
                                <option value="20">20 Years</option>
                                <option value="30" selected>30 Years</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="interest-rate" class="form-label">Interest Rate (%)</label>
                            <input type="number" class="form-control" id="interest-rate" placeholder="4.5" step="0.1" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="property-tax" class="form-label">Annual Property Tax ($)</label>
                            <input type="number" class="form-control" id="property-tax" placeholder="5,000">
                        </div>
                        
                        <div class="mb-3">
                            <label for="insurance" class="form-label">Annual Insurance ($)</label>
                            <input type="number" class="form-control" id="insurance" placeholder="1,200">
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-calculator me-2"></i>Calculate Payment
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Results -->
            <div class="col-lg-6">
                <div id="calculator-results" style="display: none;">
                    <div class="calculator-result">
                        <div class="amount" id="monthly-payment">$0</div>
                        <div class="label">Monthly Payment</div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <div class="h4 fw-bold text-primary" id="principal-interest">$0</div>
                                    <small class="text-muted">Principal & Interest</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <div class="h4 fw-bold text-primary" id="tax-insurance">$0</div>
                                    <small class="text-muted">Tax & Insurance</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="fw-bold mb-3">Payment Breakdown</h5>
                            <div class="row">
                                <div class="col-6">
                                    <p class="mb-2"><strong>Loan Amount:</strong></p>
                                    <p class="mb-2"><strong>Down Payment:</strong></p>
                                    <p class="mb-2"><strong>Interest Rate:</strong></p>
                                    <p class="mb-2"><strong>Loan Term:</strong></p>
                                </div>
                                <div class="col-6">
                                    <p class="mb-2" id="loan-amount">$0</p>
                                    <p class="mb-2" id="down-payment-display">$0</p>
                                    <p class="mb-2" id="interest-rate-display">0%</p>
                                    <p class="mb-2" id="loan-term-display">30 years</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="fw-bold mb-3">Total Costs</h5>
                            <div class="row">
                                <div class="col-6">
                                    <p class="mb-2"><strong>Total Interest:</strong></p>
                                    <p class="mb-2"><strong>Total Payment:</strong></p>
                                </div>
                                <div class="col-6">
                                    <p class="mb-2" id="total-interest">$0</p>
                                    <p class="mb-2" id="total-payment">$0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Initial State -->
                <div id="calculator-placeholder" class="text-center py-5">
                    <i class="fas fa-calculator fa-3x text-muted mb-4"></i>
                    <h4 class="fw-bold text-muted">Enter Your Details</h4>
                    <p class="text-muted">Fill out the form to see your estimated monthly payment and total costs.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Information Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h2 class="fw-bold text-center mb-5">Understanding Your Mortgage</h2>
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="fw-bold mb-3"><i class="fas fa-info-circle text-primary me-2"></i>Principal & Interest</h5>
                                <p class="text-muted">This is the core of your mortgage payment. The principal reduces your loan balance, while interest is the cost of borrowing money.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="fw-bold mb-3"><i class="fas fa-chart-line text-primary me-2"></i>Property Tax</h5>
                                <p class="text-muted">Annual property taxes are typically included in your monthly payment and held in escrow by your lender.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="fw-bold mb-3"><i class="fas fa-shield-alt text-primary me-2"></i>Insurance</h5>
                                <p class="text-muted">Homeowners insurance protects your property and is usually required by lenders. It's often included in your monthly payment.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="fw-bold mb-3"><i class="fas fa-percentage text-primary me-2"></i>Interest Rates</h5>
                                <p class="text-muted">Current rates vary based on market conditions, your credit score, loan type, and down payment amount.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h3 class="fw-bold text-primary mb-3">Ready to Start Your Home Search?</h3>
                <p class="text-muted mb-4">Our experienced mortgage specialists can help you find the best loan options for your situation.</p>
                <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center">
                    <a href="{% url 'listings:buy_home' %}" class="btn btn-primary">Browse Properties</a>
                    <a href="{% url 'inquiries:contact' %}" class="btn btn-outline-primary">Contact Mortgage Specialist</a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('mortgage-form');
    const results = document.getElementById('calculator-results');
    const placeholder = document.getElementById('calculator-placeholder');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const propertyPrice = parseFloat(document.getElementById('property-price').value);
        const downPayment = parseFloat(document.getElementById('down-payment').value);
        const loanTerm = parseInt(document.getElementById('loan-term').value);
        const interestRate = parseFloat(document.getElementById('interest-rate').value);
        const propertyTax = parseFloat(document.getElementById('property-tax').value) || 0;
        const insurance = parseFloat(document.getElementById('insurance').value) || 0;
        
        // Calculate loan amount
        const loanAmount = propertyPrice - downPayment;
        
        // Calculate monthly interest rate
        const monthlyRate = interestRate / 100 / 12;
        const numberOfPayments = loanTerm * 12;
        
        // Calculate monthly payment (principal & interest)
        const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
        
        // Calculate tax and insurance
        const monthlyTax = propertyTax / 12;
        const monthlyInsurance = insurance / 12;
        const totalMonthlyPayment = monthlyPayment + monthlyTax + monthlyInsurance;
        
        // Calculate total interest
        const totalInterest = (monthlyPayment * numberOfPayments) - loanAmount;
        const totalPayment = monthlyPayment * numberOfPayments + propertyTax + insurance;
        
        // Update results
        document.getElementById('monthly-payment').textContent = '$' + totalMonthlyPayment.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        document.getElementById('principal-interest').textContent = '$' + monthlyPayment.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        document.getElementById('tax-insurance').textContent = '$' + (monthlyTax + monthlyInsurance).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        document.getElementById('loan-amount').textContent = '$' + loanAmount.toLocaleString('en-US');
        document.getElementById('down-payment-display').textContent = '$' + downPayment.toLocaleString('en-US');
        document.getElementById('interest-rate-display').textContent = interestRate + '%';
        document.getElementById('loan-term-display').textContent = loanTerm + ' years';
        document.getElementById('total-interest').textContent = '$' + totalInterest.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        document.getElementById('total-payment').textContent = '$' + totalPayment.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        // Show results
        results.style.display = 'block';
        placeholder.style.display = 'none';
    });
});
</script>
{% endblock %}
